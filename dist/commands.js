!function(){var e,t,n={};function o(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,a=function(){};return{s:a,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,r=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return r=e.done,e},e:function(e){c=!0,i=e},f:function(){try{r||null==n.return||n.return()}finally{if(c)throw i}}}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),Office.onReady((function(n){e=Office.context.mailbox.item,t=Office.context.mailbox,console.log("Office.js is now ready in ".concat(n.host," on ").concat(n.platform))}));var a="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==n.g?n.g:void 0;a.action=function(e){var t={type:Office.MailboxEnums.ItemNotificationMessageType.InformationalMessage,message:"Performed action.",icon:"Icon.80x80",persistent:!0};Office.context.mailbox.item.notificationMessages.replaceAsync("action",t),e.completed()},a.actionMarkGreen=function(e){var t={type:Office.MailboxEnums.ItemNotificationMessageType.InformationalMessage,message:"Marked message green",icon:"IconGreen.80x80",persistent:!1},n={type:Office.MailboxEnums.ItemNotificationMessageType.InformationalMessage,message:"Failed to mark message green",icon:"IconGreen.80x80",persistent:!0};u("[Classified Green ðŸŸ¢]",(function(o){o?Office.context.mailbox.item.notificationMessages.replaceAsync("action",t):Office.context.mailbox.item.notificationMessages.replaceAsync("action",n),e.completed()}))},a.actionMarkAmber=function(e){var t={type:Office.MailboxEnums.ItemNotificationMessageType.InformationalMessage,message:"Marked message amber",icon:"IconAmber.80x80",persistent:!1},n={type:Office.MailboxEnums.ItemNotificationMessageType.InformationalMessage,message:"Failed to mark message amber",icon:"IconAmber.80x80",persistent:!0};u("[Classified Amber ðŸŸ ]",(function(o){o?Office.context.mailbox.item.notificationMessages.replaceAsync("action",t):Office.context.mailbox.item.notificationMessages.replaceAsync("action",n),e.completed()}))},a.actionMarkRed=function(e){var t={type:Office.MailboxEnums.ItemNotificationMessageType.InformationalMessage,message:"Marked message red",icon:"IconRed.80x80",persistent:!1},n={type:Office.MailboxEnums.ItemNotificationMessageType.InformationalMessage,message:"Failed to mark message red",icon:"IconRed.80x80",persistent:!0};u("[Classified Red ðŸ”´]",(function(o){o?Office.context.mailbox.item.notificationMessages.replaceAsync("action",t):Office.context.mailbox.item.notificationMessages.replaceAsync("action",n),e.completed()}))},a.validateBody=function(t){e.body.getAsync("html",{asyncContext:t},l)};var i={green:{subject:"[Classified Green ðŸŸ¢]"},amber:{subject:"[Classified Amber ðŸŸ ]"},red:{subject:"[Classified Red ðŸ”´]"}},r=/^(?:[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]?re:[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]?|[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]?awr:[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]?)*[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]?\[classified (red|green|amber) (?:[\0-\/:-@\[-\^`\{-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])\](?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*/;function c(e){if(e=e.toLowerCase(),r.test(e)){console.log("Getting matches for "+e);var t=e.match(r);return i[t[1]]}return!1}function u(n,s){var a,i,r,u;a=e.conversationId,i=function(t){var a,i=!1,r="",u=o(t);try{for(u.s();!(a=u.n()).done;){value=a.value;var l=c(value);if(l){i=!0,r=l;break}}}catch(e){u.e(e)}finally{u.f()}e.subject.getAsync((function(t){if(t.status==Office.AsyncResultStatus.Failed)console.log(t.error.message),s(!1);else{var o=c(t.value);if(o)return i&&o.subject===r.subject&&r.subject===n?void s(!0):void s(!1);i&&(n=r.subject),subject=n+" "+t.value,e.subject.setAsync(subject,null,(function(e){e.status==Office.AsyncResultStatus.Failed?(console.log(e.error.message),s(!1)):s(!0)}))}}))},r=function(e){s(!1)},u='<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"               xmlns:xsd="http://www.w3.org/2001/XMLSchema"               xmlns:m="http://schemas.microsoft.com/exchange/services/2006/messages"               xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"               xmlns:t="http://schemas.microsoft.com/exchange/services/2006/types">   <soap:Header>       <RequestServerVersion Version="Exchange2013" xmlns="http://schemas.microsoft.com/exchange/services/2006/types" soap:mustUnderstand="0" />   </soap:Header>   <soap:Body>'+(u='       <m:GetConversationItems>           <m:ItemShape>               <t:BaseShape>IdOnly</t:BaseShape>               <t:AdditionalProperties>                   <t:FieldURI FieldURI="item:Subject" />                   <t:FieldURI FieldURI="item:DateTimeReceived" />               </t:AdditionalProperties>           </m:ItemShape>           <m:FoldersToIgnore>               <t:DistinguishedFolderId Id="deleteditems" />               <t:DistinguishedFolderId Id="drafts" />           </m:FoldersToIgnore>           <m:SortOrder>TreeOrderDescending</m:SortOrder>           <m:Conversations>               <t:Conversation>                   <t:ConversationId Id="'+a+'" />               </t:Conversation>           </m:Conversations>       </m:GetConversationItems>')+"</soap:Body></soap:Envelope>",console.log("got soap header"),function(e,n,o){console.log("Starting call"),t.makeEwsRequestAsync(e,(function(e){if(console.log("Returning from call"),e.status===Office.AsyncResultStatus.Succeeded){console.log("makeEwsRequestAsync success. "+e.status);var t=(new DOMParser).parseFromString(e.value,"text/xml");n(t)}else console.log("makeEwsRequestAsync failed. "+e.error),o(e.error)}))}(u,(function(e){var t,n,s,a,r,c=[],u=o((n=e,a=(s="t:Subject").substring(s.indexOf(":")+1),null!=(r=n.getElementsByTagName(s))&&0!=r.length||(r=n.getElementsByTagName(a)),r));try{for(u.s();!(t=u.n()).done;)msg=t.value,c.push(msg.textContent)}catch(e){u.e(e)}finally{u.f()}i(c)}),(function(e){null!=r&&r()}))}function l(t){var n=new Array("blockedword","blockedword1","blockedword2").join("|");new RegExp("\\b("+n+")\\b","i").test(t.value)?(e.notificationMessages.addAsync("NoSend",{type:"errorMessage",message:"Blocked words have been found in the body of this email. Please remove them."}),t.asyncContext.completed({allowEvent:!1})):t.asyncContext.completed({allowEvent:!0})}}();
//# sourceMappingURL=commands.js.map