{"version":3,"file":"commands.js","mappings":"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","sources":["webpack://office-addin-taskpane-js/webpack/bootstrap","webpack://office-addin-taskpane-js/webpack/runtime/global","webpack://office-addin-taskpane-js/./src/commands/commands.js"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","/*\n * Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT license.\n * See LICENSE in the project root for license information.\n */\n\n/* global g, global, Office, self, window, mailbox, mailboxItem, classifications */\n\n\nlet mailboxItem;\nlet mailbox;\nconst g = getGlobal();\n\nOffice.onReady(function(info) {\n    // If needed, Office.js is ready to be called\n    mailboxItem = Office.context.mailbox.item;\n    mailbox = Office.context.mailbox;\n\nfor (let name in classifications) {\n\tlet classification = classifications[name];\n    g[classification.globalFunction] = actionMarkFactory(classification);\n}\n\n    console.log(`Office.js is now ready in ${info.host} on ${info.platform}`);\n});\n\nfunction getGlobal() {\n    return typeof self !== \"undefined\" ?\n        self :\n        typeof window !== \"undefined\" ?\n        window :\n        typeof global !== \"undefined\" ?\n        global :\n        undefined;\n}\n\n// The add-in command functions need to be available in global scope\ng.validateBody = validateBody;\n\nlet classifications = {\n    \"green\": {\n\t\t\"name\": \"TLP Green\",\n\t\t\"globalFunction\": \"actionMarkGreen\",\n        \"subject\": \"[Classified Green 🟢]\",\n        \"icon80\": \"IconGreen.80x80\"\n    },\n    \"amber\": {\n\t\t\"name\": \"TLP Amber\",\n\t\t\"globalFunction\": \"actionMarkAmber\",\n        \"subject\": \"[Classified Amber 🟠]\",\n        \"icon80\": \"IconOrange.80x80\"\n    },\n    \"red\": {\n\t\t\"name\": \"TLP Red\",\n\t\t\"globalFunction\": \"actionMarkRed\",\n        \"subject\": \"[Classified Red 🔴]\",\n        \"icon80\": \"IconRed.80x80\"\n    }\n}\n\n\nconst classifiedSubjectRegexp = /^(?:\\s?re:\\s?|\\s?aw:\\s?)*\\s?\\[classified (red|green|amber) \\W\\].*/u;\n\nfunction actionMarkFactory(classification) {\n\t\n\treturn function(event) {\n\t\t\n    let successMessage = {\n        type: Office.MailboxEnums.ItemNotificationMessageType.InformationalMessage,\n        message: \"Marked message \" + classification.name,\n        icon: classification.icon80,\n        persistent: false,\n    };\n\n    let errorMessage = {\n        type: Office.MailboxEnums.ItemNotificationMessageType.ErrorMessage,\n        message: \"Failed to mark message (requested \" + classification.name + \")\",\n    };\n\n    setSubjectPrefix(classification.subject, function(ret) {\n\n        if (ret) {\n            // Show a notification message\n            Office.context.mailbox.item.notificationMessages.replaceAsync(\"action\", successMessage);\n\n        } else {\n            // Show an error message\n            Office.context.mailbox.item.notificationMessages.replaceAsync(\"action\", errorMessage);\n        }\n\n\n        // Be sure to indicate when the add-in command function is complete\n        event.completed();\n\n    });\n    \n    };\n    \n}\n\n\nfunction checkSubjectClassified(subject) {\n    subject = subject.toLowerCase();\n    if (classifiedSubjectRegexp.test(subject)) {\n        let matches = subject.match(classifiedSubjectRegexp);\n        return classifications[matches[1]];\n    } else {\n        return false;\n    }\n}\n\n// Set the subject of the item that the user is composing.\nfunction setSubjectPrefix(prefix, callback) {\n\n    // Check conversation history\n    findConversationSubjects(mailboxItem.conversationId, function(values) {\n\n        let classifiedConversation = false;\n        let classification = \"\";\n\n        for (value of values) {\n            let curClassification = checkSubjectClassified(value);\n            if (curClassification) {\n                classifiedConversation = true;\n                classification = curClassification;\n                break;\n            }\n        }\n\n        // Check current subject\n        mailboxItem.subject.getAsync(\n            function(asyncResult) {\n                if (asyncResult.status == Office.AsyncResultStatus.Failed) {\n                    console.log(asyncResult.error.message);\n                    callback(false);\n                } else {\n                    // Successfully got the subject, display it.\n\n                    let curClassification = checkSubjectClassified(asyncResult.value)\n\n                    if (curClassification) {\n                        // Item subject classified\n\n                        if (classifiedConversation) {\n                            // TODO refactor into preflight methods, force marking for now\n                            // Item is marked and part of classified conversation\n                            \n                            if (curClassification.subject === classification.subject && classification.subject === prefix) {\n\t\t\t\t\t\t\t\t// Classification already matches, nothing to do :)\n\t\t\t\t\t\t\t\tcallback(true);\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t} else {\t                         \n                                callback(false);\n                                return;\n                            }\n                            //prefix = curClassification.subject;\n                        } else {\n                            // Item is marked and part of classified conversation\n                            callback(false);\n                            return;\n                        }\n\n\n                    } else {\n\n                        if (classifiedConversation) {\n                            // TODO refactor into preflight methods, force marking for now\n                            // Iten is unmarked, and part of classified conversation, force mark\n                            prefix = classification.subject;\n                        } else {\n                            // Proceed with marking image\n                        }\n\n                    }\n\n                    subject = prefix + ' ' + asyncResult.value;\n\n                    mailboxItem.subject.setAsync(\n                        subject, null,\n                        function(asyncResult) {\n                            if (asyncResult.status == Office.AsyncResultStatus.Failed) {\n                                console.log(asyncResult.error.message);\n                                callback(false);\n                            } else {\n                                // Successfully set the subject.\n                                // Do whatever appropriate for your scenario\n                                // using the arguments var1 and var2 as applicable.\n                                callback(true);\n\n\n\n                            }\n                        });\n\n\n\n\n                }\n            });\n\n\n\n    }, function(error) {\n\n        callback(false);\n\n    });\n\n\n\n}\n\n// Demo functions adapted from Microsoft\n// MIT License, https://github.com/OfficeDev/Office-Add-in-samples\n\n// Entry point for Contoso Message Body Checker add-in before send is allowed.\n// <param name=\"event\">MessageSend event is automatically passed by BlockOnSend code to the function specified in the manifest.</param>\nfunction validateBody(event) {\n    mailboxItem.body.getAsync(\"html\", {\n        asyncContext: event\n    }, checkBodyOnlyOnSendCallBack);\n}\n\n// Invoke by Contoso Subject and CC Checker add-in before send is allowed.\n// <param name=\"event\">MessageSend event is automatically passed by BlockOnSend code to the function specified in the manifest.</param>\nfunction validateSubjectAndCC(event) {\n    shouldChangeSubjectOnSend(event);\n}\n\n// Check if the subject should be changed. If it is already changed allow send. Otherwise change it.\n// <param name=\"event\">MessageSend event passed from the calling function.</param>\nfunction shouldChangeSubjectOnSend(event) {\n    mailboxItem.subject.getAsync({\n            asyncContext: event\n        },\n        function(asyncResult) {\n            addCCOnSend(asyncResult.asyncContext);\n            //console.log(asyncResult.value);\n            // Match string.\n            var checkSubject = (new RegExp(/\\[Checked\\]/)).test(asyncResult.value)\n            // Add [Checked]: to subject line.\n            subject = '[Checked]: ' + asyncResult.value;\n\n            // Check if a string is blank, null or undefined.\n            // If yes, block send and display information bar to notify sender to add a subject.\n            if (asyncResult.value === null || (/^\\s*$/).test(asyncResult.value)) {\n                mailboxItem.notificationMessages.addAsync('NoSend', {\n                    type: 'errorMessage',\n                    message: 'Please enter a subject for this email.'\n                });\n                asyncResult.asyncContext.completed({\n                    allowEvent: false\n                });\n            } else {\n                // If can't find a [Checked]: string match in subject, call subjectOnSendChange function.\n                if (!checkSubject) {\n                    subjectOnSendChange(subject, asyncResult.asyncContext);\n                    //console.log(checkSubject);\n                } else {\n                    // Allow send.\n                    asyncResult.asyncContext.completed({\n                        allowEvent: true\n                    });\n                }\n            }\n\n        }\n    )\n}\n\n// Add a CC to the email.  In this example, CC contoso@contoso.onmicrosoft.com\n// <param name=\"event\">MessageSend event passed from calling function</param>\nfunction addCCOnSend(event) {\n    mailboxItem.cc.setAsync(['Contoso@contoso.onmicrosoft.com'], {\n        asyncContext: event\n    });\n}\n\n// Check if the subject should be changed. If it is already changed allow send, otherwise change it.\n// <param name=\"subject\">Subject to set.</param>\n// <param name=\"event\">MessageSend event passed from the calling function.</param>\nfunction subjectOnSendChange(subject, event) {\n    mailboxItem.subject.setAsync(\n        subject, {\n            asyncContext: event\n        },\n        function(asyncResult) {\n            if (asyncResult.status == Office.AsyncResultStatus.Failed) {\n                mailboxItem.notificationMessages.addAsync('NoSend', {\n                    type: 'errorMessage',\n                    message: 'Unable to set the subject.'\n                });\n\n                // Block send.\n                asyncResult.asyncContext.completed({\n                    allowEvent: false\n                });\n            } else {\n                // Allow send.\n                asyncResult.asyncContext.completed({\n                    allowEvent: true\n                });\n            }\n\n        });\n}\n\n// Check if the body contains a specific set of blocked words. If it contains the blocked words, block email from being sent. Otherwise allows sending.\n// <param name=\"asyncResult\">MessageSend event passed from the calling function.</param>\nfunction checkBodyOnlyOnSendCallBack(asyncResult) {\n    var listOfBlockedWords = new Array(\"blockedword\", \"blockedword1\", \"blockedword2\");\n    var wordExpression = listOfBlockedWords.join('|');\n\n    // \\b to perform a \"whole words only\" search using a regular expression in the form of \\bword\\b.\n    // i to perform case-insensitive search.\n    var regexCheck = new RegExp('\\\\b(' + wordExpression + ')\\\\b', 'i');\n    var checkBody = regexCheck.test(asyncResult.value);\n\n    if (checkBody) {\n        mailboxItem.notificationMessages.addAsync('NoSend', {\n            type: 'errorMessage',\n            message: 'Blocked words have been found in the body of this email. Please remove them.'\n        });\n        // Block send.\n        asyncResult.asyncContext.completed({\n            allowEvent: false\n        });\n    } else {\n\n        // Allow send.\n        asyncResult.asyncContext.completed({\n            allowEvent: true\n        });\n    }\n}\n\n\n// Following functions adapted from easyEws\n// GNU Public License v3, https://github.com/davecra/easyEWS\n\nfunction asyncEws(soap, successCallback, errorCallback) {\n\n    mailbox.makeEwsRequestAsync(soap, function(ewsResult) {\n        if (ewsResult.status === Office.AsyncResultStatus.Succeeded) {\n            console.log(\"makeEwsRequestAsync success. \" + ewsResult.status);\n            let parser = new DOMParser();\n            let xmlDoc = parser.parseFromString(ewsResult.value, \"text/xml\");\n            successCallback(xmlDoc);\n        } else {\n            console.log(\"makeEwsRequestAsync failed. \" + ewsResult.error);\n            errorCallback(ewsResult.error);\n        }\n    });\n\n};\n\nfunction getNodes(node, elementNameWithNS) {\n    let elementWithoutNS = elementNameWithNS.substring(elementNameWithNS.indexOf(\":\") + 1);\n    let retVal = node.getElementsByTagName(elementNameWithNS);\n    if (retVal == null || retVal.length == 0) {\n        retVal = node.getElementsByTagName(elementWithoutNS);\n    }\n    return retVal;\n};\n\nfunction getSoapHeader(request) {\n    let result =\n        '<?xml version=\"1.0\" encoding=\"utf-8\"?>' +\n        '<soap:Envelope xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"' +\n        '               xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\"' +\n        '               xmlns:m=\"http://schemas.microsoft.com/exchange/services/2006/messages\"' +\n        '               xmlns:soap=\"http://schemas.xmlsoap.org/soap/envelope/\"' +\n        '               xmlns:t=\"http://schemas.microsoft.com/exchange/services/2006/types\">' +\n        '   <soap:Header>' +\n        '       <RequestServerVersion Version=\"Exchange2013\" xmlns=\"http://schemas.microsoft.com/exchange/services/2006/types\" soap:mustUnderstand=\"0\" />' +\n        '   </soap:Header>' +\n        '   <soap:Body>' + request + '</soap:Body>' +\n        '</soap:Envelope>';\n    return result;\n};\n\nfunction findConversationSubjects(conversationId, successCallback, errorCallback) {\n\tif (!conversationId) {\n\t\t\t// Trivial case, no conversations here\n\t\t\tsuccessCallback([]);\n\t}\n    let soap =\n        '       <m:GetConversationItems>' +\n        '           <m:ItemShape>' +\n        '               <t:BaseShape>IdOnly</t:BaseShape>' +\n        '               <t:AdditionalProperties>' +\n        '                   <t:FieldURI FieldURI=\"item:Subject\" />' +\n        '                   <t:FieldURI FieldURI=\"item:DateTimeReceived\" />' +\n        '               </t:AdditionalProperties>' +\n        '           </m:ItemShape>' +\n        '           <m:FoldersToIgnore>' +\n        '               <t:DistinguishedFolderId Id=\"deleteditems\" />' +\n        '               <t:DistinguishedFolderId Id=\"drafts\" />' +\n        '           </m:FoldersToIgnore>' +\n        '           <m:SortOrder>TreeOrderDescending</m:SortOrder>' +\n        '           <m:Conversations>' +\n        '               <t:Conversation>' +\n        '                   <t:ConversationId Id=\"' + conversationId + '\" />' +\n        '               </t:Conversation>' +\n        '           </m:Conversations>' +\n        '       </m:GetConversationItems>';\n    soap = getSoapHeader(soap);\n    // Make EWS call\n    asyncEws(soap, function(xmlDoc) {\n        let nodes = getNodes(xmlDoc, \"t:Subject\");\n        let msgs = [];\n        for (let msg of nodes) {\n            msgs.push(msg.textContent);\n        }\n        successCallback(msgs);\n\n    }, function(errorDetails) {\n        if (errorCallback != null)\n            errorCallback(errorDetails);\n    });\n};\n"],"names":["mailboxItem","mailbox","g","getGlobal","Office","onReady","info","context","item","name","classifications","classification","globalFunction","actionMarkFactory","console","log","concat","host","platform","self","window","global","undefined","validateBody","classifiedSubjectRegexp","event","successMessage","type","MailboxEnums","ItemNotificationMessageType","InformationalMessage","message","icon","icon80","persistent","errorMessage","ErrorMessage","setSubjectPrefix","subject","ret","notificationMessages","replaceAsync","completed","checkSubjectClassified","toLowerCase","test","matches","match","prefix","callback","findConversationSubjects","conversationId","values","classifiedConversation","_iterator","_createForOfIteratorHelper","_step","s","n","done","value","curClassification","err","e","f","getAsync","asyncResult","status","AsyncResultStatus","Failed","error","setAsync","body","asyncContext","checkBodyOnlyOnSendCallBack","validateSubjectAndCC","shouldChangeSubjectOnSend","addCCOnSend","checkSubject","RegExp","addAsync","allowEvent","subjectOnSendChange","cc","listOfBlockedWords","Array","wordExpression","join","regexCheck","checkBody","asyncEws","soap","successCallback","errorCallback","makeEwsRequestAsync","ewsResult","Succeeded","parser","DOMParser","xmlDoc","parseFromString","getNodes","node","elementNameWithNS","elementWithoutNS","substring","indexOf","retVal","getElementsByTagName","length","getSoapHeader","request","result","nodes","msgs","_iterator2","_step2","msg","push","textContent","errorDetails"],"sourceRoot":""}